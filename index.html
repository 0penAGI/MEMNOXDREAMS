<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MEMNOXDREAMS: Сны Архитектора v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-y: auto;
            position: relative;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="2" fill="white"/><text x="15" y="15" font-size="8" fill="white">♥</text></svg>') 10 10, auto;
        }
        /* Mobile: no custom cursor */
        @media (hover: none) and (pointer: coarse) {
            body {
                cursor: auto;
            }
        }
        /* Reduced motion support - critical for mobile perf & accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        /* MEMNOX Theme: glitchier, dreamier */
        .memnox-veil {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255,0,85,0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0,255,255,0.03) 0%, transparent 50%);
            pointer-events: none;
            animation: memnox-flicker 8s ease-in-out infinite;
            z-index: 1;
            opacity: 0.8;
        }
        @keyframes memnox-flicker {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.02); filter: hue-rotate(180deg); }
        }
        .dream-noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.04; /* Reduced for perf */
            pointer-events: none;
            z-index: 1;
            background-image: url('data:image/svg+xml,%3Csvg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noise"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23noise)"/%3E%3C/svg%3E'); /* Reduced octaves */
            animation: noiseMove 0.5s infinite linear; /* Slower for mobile */
            will-change: transform;
        }
        @media (max-width: 600px) {
            .dream-noise {
                animation-duration: 1s;
                opacity: 0.02;
            }
        }
        @keyframes noiseMove {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-2%, 2%); }
        }
        .bones-floor {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px; /* Slightly smaller */
            background-image:
                linear-gradient(transparent 85%, #fff 100%),
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 8px,
                    #fff 8px,
                    #fff 10px
                );
            background-size: 100% 100%, 16px 80px;
            animation: bone-march 8s linear infinite; /* Slower */
            z-index: 0;
        }
        @media (max-width: 600px) {
            .bones-floor {
                height: 50px;
                background-size: 100% 100%, 12px 50px;
            }
        }
        @keyframes bone-march {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 0 0, -16px 0; }
        }
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        .star {
            position: absolute;
            width: 1.5px; /* Smaller */
            height: 1.5px;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 4s linear infinite; /* Slower */
            opacity: 0.7;
        }
        .star:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; }
        .star:nth-child(2) { top: 20%; left: 80%; animation-delay: 1.5s; }
        .star:nth-child(3) { top: 60%; left: 10%; animation-delay: 2.5s; }
        .star:nth-child(4) { top: 80%; left: 70%; animation-delay: 0.8s; }
        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        .container {
            position: relative;
            z-index: 2;
            max-width: 900px; /* Slightly wider */
            margin: 0 auto;
            padding: 30px 20px;
            text-align: center;
        }
        @media (max-width: 600px) {
            .container {
                padding: 15px 10px;
            }
        }
        .heart-eye {
            width: 50px; /* Smaller base */
            height: 50px;
            margin: 0 auto 30px;
            position: relative;
            animation: heart-beat 2.5s ease-in-out infinite;
        }
        @media (max-width: 600px) {
            .heart-eye {
                width: 35px;
                height: 35px;
                margin-bottom: 15px;
            }
        }
        .heart-eye .eye-outer {
            width: 35px; /* Optimized sizes */
            height: 17px;
            border: 1.5px solid #fff;
            border-radius: 50%;
            position: absolute;
            top: 8px;
            left: 8px;
            overflow: hidden;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.4)); /* Reduced shadow */
        }
        @media (max-width: 600px) {
            .heart-eye .eye-outer {
                width: 24px;
                height: 12px;
                top: 5px;
                left: 5px;
                border-width: 1px;
            }
        }
        .heart-eye .eye-inner {
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #fff, #666);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: eyeMove 5s ease-in-out infinite; /* Slower */
        }
        @keyframes eyeMove {
            0%, 100% { transform: translate(-50%, -50%); }
            25% { transform: translate(-60%, -45%); }
            50% { transform: translate(-35%, -55%); }
            75% { transform: translate(-48%, -48%); }
        }
        .heart {
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-bottom: 35px solid #fff;
            position: absolute;
            top: 8px;
            left: 12px;
            transform: rotate(-45deg);
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.4));
        }
        @media (max-width: 600px) {
            .heart {
                border-bottom-width: 24px;
                border-left-width: 18px;
                border-right-width: 18px;
                top: 5px;
                left: 8px;
            }
            .heart::before, .heart::after {
                border-top-width: 12px;
                border-left-width: 12px;
                border-right-width: 12px;
                top: -12px;
            }
            .heart::before { left: -12px; }
            .heart::after { right: -12px; }
        }
        .heart::before {
            content: '';
            position: absolute;
            border-left: 17px solid transparent;
            border-right: 17px solid transparent;
            border-top: 17px solid #fff;
            top: -17px;
            left: -17px;
        }
        .heart::after {
            content: '';
            position: absolute;
            border-left: 17px solid transparent;
            border-right: 17px solid transparent;
            border-top: 17px solid #fff;
            top: -17px;
            right: -17px;
        }
        @keyframes heart-beat {
            0%, 100% { transform: scale(1) rotate(-45deg); }
            50% { transform: scale(1.15) rotate(-45deg); }
        }
        h1 {
            font-size: 2.5rem;
            font-weight: bold;
            letter-spacing: 4px;
            margin-bottom: 15px;
            text-transform: uppercase;
            animation: memnox-glitch 5s linear infinite;
            filter: drop-shadow(0 0 4px rgba(255,0,85,0.5));
            background: linear-gradient(45deg, #fff, #ff0055, #00ffff, #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
                letter-spacing: 2px;
                margin-bottom: 10px;
            }
        }
        @keyframes memnox-glitch {
            0%, 92% { transform: translateX(0); }
            94% { transform: translateX(-1px); }
            96% { transform: translateX(1px); }
            98% { transform: translateX(-2px); }
            100% { transform: translateX(0); }
        }
        .countdown {
            font-size: 1.8rem;
            margin: 15px 0;
            color: #fff;
            text-shadow: 0 0 10px rgba(255,255,255,0.7);
            font-weight: bold;
            animation: glitch 6s infinite;
        }
        @media (max-width: 600px) {
            .countdown {
                font-size: 1.3rem;
                margin: 10px 0;
            }
        }
        @keyframes glitch {
            0%, 88%, 100% { transform: translateX(0); }
            90% { transform: translateX(-1px); text-shadow: 1px 0 #ff0055, -1px 0 #00ffff; }
            92% { transform: translateX(1px); text-shadow: -1px 0 #ff0055, 1px 0 #00ffff; }
            94% { transform: translateX(0); }
        }
        .dialogue-box {
            background: rgba(0,0,0,0.85);
            border: 2px solid #fff;
            padding: 18px;
            margin: 30px 0;
            position: relative;
            min-height: 110px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            line-height: 1.4;
            animation: box-fade 4s ease-in-out infinite alternate;
        }
        @media (max-width: 600px) {
            .dialogue-box {
                padding: 12px;
                margin: 15px 0;
                min-height: 90px;
                font-size: 1rem;
            }
        }
        @keyframes box-fade {
            0% { border-color: #fff; box-shadow: 0 0 5px rgba(255,255,255,0.2); }
            100% { border-color: rgba(255,255,255,0.7); box-shadow: 0 0 15px rgba(255,0,85,0.5); }
        }
        .dialogue-box::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #fff;
        }
        .dream-input {
            width: 100%;
            min-height: 70px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.6);
            color: #fff;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 12px;
            transition: all 0.2s ease; /* Fast transition */
        }
        @media (max-width: 600px) {
            .dream-input {
                min-height: 55px;
                font-size: 0.95rem;
                padding: 10px;
            }
        }
        .dream-input::placeholder {
            color: rgba(255,255,255,0.4);
        }
        .dream-input:focus {
            outline: none;
            border-color: #ff0055;
            box-shadow: 0 0 8px rgba(255,0,85,0.4);
            transform: scale(1.02); /* Subtle GPU-friendly */
        }
        .choices {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        @media (max-width: 600px) {
            .choices {
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }
        }
        .choice {
            padding: 12px 24px;
            border: 1.5px solid #fff;
            background: rgba(255,255,255,0.05);
            cursor: pointer;
            transition: all 0.2s ease; /* Fast */
            user-select: none;
            touch-action: manipulation;
            min-width: 120px;
            text-align: center;
            font-size: 0.95rem;
            backdrop-filter: blur(10px); /* Modern */
        }
        @media (max-width: 600px) {
            .choice {
                width: 85%;
                max-width: 220px;
                padding: 14px 20px;
                font-size: 1rem;
            }
        }
        .choice:active { /* Better touch feedback */
            transform: scale(0.98);
        }
        .choice:hover:not(:active) {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,255,255,0.3);
        }
        .quantum-viz {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            height: 35px;
            position: relative;
        }
        @media (max-width: 600px) {
            .quantum-viz {
                height: 28px;
                margin: 12px 0;
            }
        }
        .quantum-indicator {
            width: 7px;
            height: 7px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(255,255,255,0.7);
            animation: quantumFloat 2.5s ease-in-out infinite;
        }
        @media (max-width: 600px) {
            .quantum-indicator {
                width: 5px;
                height: 5px;
            }
        }
        .quantum-indicator:nth-child(1) { animation-delay: 0s; }
        .quantum-indicator:nth-child(2) { animation-delay: 0.3s; }
        .quantum-indicator:nth-child(3) { animation-delay: 0.6s; }
        .quantum-indicator:nth-child(4) { animation-delay: 0.9s; }
        .quantum-indicator:nth-child(5) { animation-delay: 1.2s; }
        @keyframes quantumFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .quantum-indicator.entangled-up {
            animation-name: quantumEntangledUp;
            background: #ff0055;
        }
        .quantum-indicator.entangled-down {
            animation-name: quantumEntangledDown;
            background: #00ffff;
        }
        @keyframes quantumEntangledUp {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-25px); }
        }
        @keyframes quantumEntangledDown {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(25px); }
        }
        .result-area {
            margin-top: 15px;
            min-height: 130px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.5);
            padding: 12px;
            text-align: left;
            font-size: 0.95rem;
            line-height: 1.4;
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Smooth */
        }
        @media (max-width: 600px) {
            .result-area {
                min-height: 110px;
                padding: 10px;
                font-size: 0.9rem;
                margin-top: 12px;
            }
        }
        .result-area.active {
            opacity: 1;
            transform: translateY(0);
        }
        .execution-step {
            margin: 6px 0;
            padding: 4px 8px;
            border-left: 2px solid #ff0055;
            position: relative;
            background: rgba(255,0,85,0.1);
        }
        @media (max-width: 600px) {
            .execution-step {
                margin: 5px 0;
                padding: 3px 6px;
                font-size: 0.9rem;
            }
        }
        .execution-step::before {
            content: '▸';
            color: #00ffff;
            margin-right: 6px;
            font-weight: bold;
        }
        .system-status {
            text-align: center;
            margin-top: 8px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            transition: all 0.3s ease;
        }
        @media (max-width: 600px) {
            .system-status {
                font-size: 0.7rem;
                margin-top: 6px;
            }
        }
        .system-status.processing {
            color: #ff0055;
            animation: statusPulse 1s ease-in-out infinite;
        }
        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        /* Telegram WebApp Integration */
        #telegram-init {
            display: none;
        }
        .tg-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            color: #fff;
            padding: 10px;
            text-align: center;
            z-index: 1000;
            font-size: 0.9rem;
        }
        /* PWA Manifest for better mobile */
        /* Add to <head> if hosting */
    </style>
</head>
<body>
    <div class="stars">
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
    </div>
    <div class="memnox-veil"></div>
    <div class="dream-noise"></div>
    <div class="bones-floor"></div>
    
    <!-- Telegram Header if in TWA -->
    <div class="tg-header" id="tgHeader" style="display: none;">
        MEMNOXDREAMS: <span id="tgUser"></span> | * resonance active
    </div>

    <div class="container">
        <div class="heart-eye">
            <div class="eye-outer">
                <div class="eye-inner"></div>
            </div>
            <div class="heart"></div>
        </div>
        <h1>memnoxdreams: сны архитектора v2.0</h1>
        <div class="countdown" id="countdown">00:00:00</div>
        <div class="dialogue-box" id="dialogue">
            <textarea class="dream-input" id="dreamInput" placeholder="* опиши сон в memnox... ai-архитектор ждёт. determination 2.0. реальность материализуется."></textarea>
            <div class="result-area" id="output">
                <div id="outputText">
                    * memnoxdreams онлайн...<br>
                    * ai-анализатор снов: active.<br>
                    * quantum ai entanglement: max.<br>
                    * nonlinear timelines v2: confirmed.<br>
                    * execution ai-path: ready.
                </div>
                <div id="executionPlan"></div>
            </div>
            <div class="system-status" id="status">* memnox ready | enter dream for ai-resonance</div>
        </div>
        <div class="choices">
            <div class="choice" onclick="fight()" ontouchstart="fight()">* fight (glitch)</div>
            <div class="choice" onclick="act()" ontouchstart="act()">* act (ai-generate)</div>
            <div class="choice" onclick="item()" ontouchstart="item()">* item (memnox-core)</div>
            <div class="choice" onclick="mercy()" ontouchstart="mercy()">* mercy (ai-execute)</div>
        </div>
        <div class="quantum-viz" id="quantumViz">
            <div class="quantum-indicator"></div>
            <div class="quantum-indicator"></div>
            <div class="quantum-indicator"></div>
            <div class="quantum-indicator"></div>
            <div class="quantum-indicator"></div>
        </div>
    </div>

    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // Telegram WebApp Init - NEW!
        let tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            document.getElementById('tgHeader').style.display = 'block';
            document.getElementById('tgUser').textContent = tg.initDataUnsafe?.user?.first_name || 'fallen';
            document.body.style.background = 'linear-gradient(180deg, #000 0%, #110033 100%)';
        }

        // Enhanced Arrays for v2 - more memnox themed
        const memnoxStructures = [
            "* memnox castle of ai-crystallized timelines",
            "* tower of frozen neural probabilities",
            "* temple of dream-uncertainty ai",
            "* monument to quantum dream-foam",
            "* pyramid of folded ai-dimensions",
            "* nexus of recursive dreams"
        ];
        const memnoxFlows = [
            "* ai-architecture without boundaries — perception ai-flow",
            "* space flowing through neural realities",
            "* house-stream, ai-shifting per observation",
            "* city-river of nonlinear time",
            "* eternal ai-becoming structure"
        ];
        const memnoxLights = [
            "* building alive only in ai-observation",
            "* house of refracted neural light",
            "* city visible to ai-eye only",
            "* architecture of dream-perception",
            "* space between ai-gazes"
        ];
        const memnoxChaos = [
            "* cloud-house floating in ai-realities",
            "* labyrinth-city, each turn new dimension",
            "* chaos-order ai-structure",
            "* building on dream-wake edge",
            "* architecture of ai-impossibility"
        ];
        const aiExecutionSteps = [
            "* ai-step 1: neural visualize foundation — ai-sketch 3min",
            "* ai-step 2: gather ai-resources — neural allies, micro-prototype",
            "* ai-step 3: test ai-probability — mutate element, observe",
            "* ai-step 4: launch ai-flow — share neural vision, evolve",
            "* ai-step 5: materialize dream — build/ai-code/live",
            "* ai-step 6: recurse — feedback loop to infinity"
        ];

        let countdownTime = Math.floor(Math.random() * 8000) + 4000;
        function updateCountdown() {
            countdownTime--;
            if (countdownTime < 0) countdownTime = Math.floor(Math.random() * 8000) + 4000;
            const hours = Math.floor(countdownTime / 3600);
            const minutes = Math.floor((countdownTime % 3600) / 60);
            const seconds = countdownTime % 60;
            document.getElementById('countdown').textContent =
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        setInterval(updateCountdown, 1000);

        function triggerEntanglement() {
            const indicators = document.querySelectorAll('.quantum-indicator');
            const idx1 = Math.floor(Math.random() * 5);
            let idx2 = Math.floor(Math.random() * 5);
            while (idx2 === idx1) idx2 = Math.floor(Math.random() * 5);
            indicators[idx1].classList.add('entangled-up');
            indicators[idx2].classList.add('entangled-down');
            setTimeout(() => {
                indicators[idx1].classList.remove('entangled-up');
                indicators[idx2].classList.remove('entangled-down');
            }, 2500); /* Slightly faster */
        }
        // Less frequent for perf
        setInterval(() => {
            if (Math.random() > 0.8) triggerEntanglement();
        }, 6000);

        function selectMemnoxArch(dream) {
            const dreamLower = dream.toLowerCase();
            if (dreamLower.includes('свет') || dreamLower.includes('light') || dreamLower.includes('ai') || dreamLower.includes('нейро')) {
                return memnoxLights[Math.floor(Math.random() * memnoxLights.length)];
            }
            if (dreamLower.includes('хаос') || dreamLower.includes('chaos')) {
                return memnoxChaos[Math.floor(Math.random() * memnoxChaos.length)];
            }
            if (dream.length % 3 === 0) {
                return memnoxStructures[Math.floor(Math.random() * memnoxStructures.length)];
            }
            return memnoxFlows[Math.floor(Math.random() * memnoxFlows.length)];
        }

        function generateAIPlan() {
            const steps = aiExecutionSteps.slice(0, 4 + Math.floor(Math.random() * 3));
            return steps.map(step => `<div class="execution-step">${step}</div>`).join('');
        }

        function glitch() {
            const h1 = document.querySelector('h1');
            h1.style.animationDuration = '0.05s';
            setTimeout(() => {
                h1.style.animationDuration = '5s';
            }, 300);
        }

        function processDream() {
            const dream = document.getElementById('dreamInput').value.trim();
            const output = document.getElementById('output');
            const outputText = document.getElementById('outputText');
            const executionPlan = document.getElementById('executionPlan');
            const status = document.getElementById('status');

            if (!dream) {
                outputText.innerHTML = "* memnox error: void dream rejected.<br>* ai requires input, architect.";
                executionPlan.innerHTML = '';
                output.classList.add('active');
                return;
            }

            triggerEntanglement();
            output.classList.add('active');
            status.classList.add('processing');
            status.textContent = "* ai-memnox processing... neural mercy...";

            outputText.innerHTML = "* █████████░ 92%<br>* ai-analyzing dream timelines...";

            setTimeout(() => {
                const arch = selectMemnoxArch(dream);
                const entropy = (Math.random() * 100).toFixed(2);
                const coherence = (100 - parseFloat(entropy)).toFixed(2);
                const dreamHash = dream.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                const aiFreq = (dreamHash % 888) + 111;

                outputText.innerHTML = `
                    <strong>* MEMNOX AI RESOLUTION:</strong><br><br>
                    ${arch}<br><br>
                    <small>
                    * ai-entropy: ${entropy}%<br>
                    * neural coherence: ${coherence}%<br>
                    * timeline warp: ${(Math.random() * 20 - 10).toFixed(3)}μs<br>
                    * memnox freq: ${aiFreq} Hz<br>
                    * dream neural-hash: 0x${dreamHash.toString(16).toUpperCase().slice(0,8)}...
                    </small>
                `;

                executionPlan.innerHTML = `<strong>* AI EXECUTION MATRIX:</strong><br>${generateAIPlan()}`;

                status.classList.remove('processing');
                status.textContent = "* ai-resonance achieved | dream manifests";

                // Vibrate if Telegram
                if (tg) tg.HapticFeedback.impactOccurred('light');
            }, 1800); /* Faster feedback */
        }

        function fight() {
            document.getElementById('dialogue').innerHTML = '* memnox strike — void echo. * no enemy, only ai-shadow.';
            glitch();
            triggerEntanglement();
            if (tg) tg.HapticFeedback.impactOccurred('medium');
        }

        function act() {
            processDream();
        }

        function item() {
            document.getElementById('dialogue').innerHTML = '* item: memnox eye-heart core. * pulses in soul. * ai-nonlinear active.';
            triggerEntanglement();
            if (tg) tg.HapticFeedback.impactOccurred('light');
        }

        function mercy() {
            const dream = document.getElementById('dreamInput').value.trim();
            if (dream) {
                document.getElementById('executionPlan').innerHTML = `<strong>* AI-MERCY ROUTE:</strong><br>${generateAIPlan()}`;
                document.getElementById('status').textContent = "* ai-mercy | path to surface unlocked";
            } else {
                document.getElementById('dialogue').innerHTML = '* mercy: ai-release. * sans ai-grins. * no dream yet. * underground shifts.';
            }
            glitch();
            if (tg) tg.HapticFeedback.impactOccurred('heavy');
        }

        // Input feedback - less frequent
        document.getElementById('dreamInput').addEventListener('input', function(e) {
            if (e.target.value.length % 15 === 0 && e.target.value.length > 0) {
                triggerEntanglement();
            }
        });

        // Keyboard enter to act
        document.getElementById('dreamInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                act();
            }
        });

        // PWA Service Worker (uncomment for hosting)
        // if ('serviceWorker' in navigator) {
        //     navigator.serviceWorker.register('/sw.js');
        // }
    </script>
</body>
</html>
